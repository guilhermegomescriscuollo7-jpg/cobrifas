<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo | COBRIFAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #ffcc00;
            --primary-glow: rgba(255, 204, 0, 0.5);
            --bg-dark: #050505;
            --glass-bg: rgba(20, 20, 20, 0.95);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --white: #ffffff;
            --text-muted: #aaaaaa;
            --red: #ff4444;
            --green: #00ff66;
            --blue: #00a2ff;
            --orange: #ffaa00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 15% 50%, rgba(255, 204, 0, 0.08) 0%, transparent 25%),
                url('https://images8.alphacoders.com/132/1328325.png');
            background-attachment: fixed; background-size: cover;
            color: var(--white); font-family: 'Rajdhani', sans-serif;
            height: 100vh; overflow: hidden;
        }

        .admin-wrapper { display: grid; grid-template-columns: 260px 1fr; height: 100vh; }

        /* SIDEBAR */
        aside {
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(20px);
            border-right: var(--glass-border); padding: 30px 20px;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .logo-adm { font-family: 'Orbitron'; font-size: 1.8rem; text-align: center; color: var(--primary); margin-bottom: 50px; text-shadow: 0 0 15px var(--primary-glow); }
        .nav-menu { display: flex; flex-direction: column; gap: 12px; }
        .nav-link {
            padding: 16px 20px; border-radius: 8px; cursor: pointer; transition: 0.3s;
            font-family: 'Orbitron'; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);
            display: flex; align-items: center; gap: 15px; border: 1px solid transparent;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255, 204, 0, 0.1); color: var(--primary); border-color: rgba(255, 204, 0, 0.3); }

        /* MAIN */
        main { padding: 40px; overflow-y: auto; }
        .header-title { font-family: 'Orbitron'; font-size: 1.8rem; margin-bottom: 40px; display: flex; align-items: center; gap: 20px; text-transform: uppercase; }
        .header-title::before { content: ''; width: 8px; height: 30px; background: var(--primary); border-radius: 4px; box-shadow: 0 0 15px var(--primary); }

        .tab-content { display: none; animation: fadeInUp 0.5s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .glass-panel { background: var(--glass-bg); backdrop-filter: blur(25px); border: var(--glass-border); border-radius: 12px; padding: 30px; margin-bottom: 30px; }

        /* TABLES */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { text-align: left; padding: 15px 20px; font-family: 'Orbitron'; font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }
        td { background: rgba(255,255,255,0.03); padding: 15px 20px; border-top: var(--glass-border); border-bottom: var(--glass-border); vertical-align: middle; }
        tr td:first-child { border-radius: 10px 0 0 10px; border-left: 3px solid var(--primary); }
        tr td:last-child { border-radius: 0 10px 10px 0; }

        /* BUTTONS */
        .btn-action { padding: 8px 12px; border: none; border-radius: 4px; font-family: 'Orbitron'; font-size: 0.6rem; cursor: pointer; transition: 0.3s; margin-right: 5px; font-weight: bold; }
        .btn-green { background: var(--green); color: #000; }
        .btn-red { background: rgba(255, 68, 68, 0.1); color: var(--red); border: 1px solid var(--red); }
        .btn-red:hover { background: var(--red); color: #fff; }
        .btn-blue { background: rgba(0, 162, 255, 0.15); color: var(--blue); border: 1px solid var(--blue); }
        .btn-save { width:100%; padding:15px; background:var(--primary); border:none; font-weight:900; cursor:pointer; font-family: 'Orbitron'; color: #000; border-radius: 6px; margin-top: 10px; }

        /* INPUTS */
        input, select { width:100%; padding:15px; background:rgba(0,0,0,0.5); border:1px solid #333; color:#fff; border-radius: 6px; font-family: 'Rajdhani'; margin-bottom: 15px; }
        label { display:block; color:var(--primary); font-size:0.7rem; margin-bottom:8px; font-family:'Orbitron'; }
    </style>
</head>
<body>

    <div class="admin-wrapper">
        <aside>
            <div>
                <div class="logo-adm">COB<span>ADM</span></div>
                <nav class="nav-menu">
                    <div class="nav-link active" onclick="openTab(event, 'dash')">投 DASHBOARD</div>
                    <div class="nav-link" onclick="openTab(event, 'membros')">則 MEMBROS</div>
                    <div class="nav-link" onclick="openTab(event, 'pagamentos')">頂 PAGAMENTOS</div>
                    <div class="nav-link" onclick="openTab(event, 'rifas')">笞｡ RIFAS</div>
                </nav>
            </div>
            <div class="nav-link" onclick="location.href='index.html'" style="color:var(--red);">坎 SAIR</div>
        </aside>

        <main>
            <section id="dash" class="tab-content active">
                <div class="header-title">VISﾃグ GERAL</div>
                <div id="statsContainer">Aguardando dados...</div>
            </section>

            <section id="membros" class="tab-content">
                <div class="header-title">GERENCIAR MEMBROS</div>
                <div class="glass-panel">
                    <table>
                        <thead><tr><th>MEMBRO</th><th>CPF</th><th>CARGO</th><th>Aﾃﾃ髭S</th></tr></thead>
                        <tbody id="listaMembrosBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="pagamentos" class="tab-content">
                <div class="header-title">APROVAR PAGAMENTOS</div>
                <div class="glass-panel">
                    <table>
                        <thead><tr><th>USUﾃヽIO</th><th>RIFA</th><th>VALOR</th><th>COMPROVANTE</th><th>Aﾃﾃグ</th></tr></thead>
                        <tbody id="listaPagamentosBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="rifas" class="tab-content">
                <div class="header-title">GERENCIAR RIFAS</div>
                <div class="glass-panel">
                    <h3 style="margin-bottom:20px; font-family:Orbitron;">NOVA RIFA</h3>
                    <input type="text" id="rifaNome" placeholder="Nome da Skin">
                    <input type="text" id="rifaImg" placeholder="URL da Imagem">
                    <input type="number" id="rifaPreco" placeholder="Preﾃｧo unitﾃ｡rio (R$)">
                    <input type="number" id="rifaTotal" placeholder="Total de Cotas">
                    <button class="btn-save" onclick="addRifa()">CRIAR RIFA NO FIREBASE</button>
                </div>
                <div id="listaRifasAdm"></div>
            </section>
        </main>
    </div>

    <script>
        // 1. CONFIGURAﾃﾃグ FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBfX7oMSNn4gSL1Knfx-yvwBwkX4H7JjQg",
            authDomain: "cobrifas.firebaseapp.com",
            projectId: "cobrifas",
            storageBucket: "cobrifas.firebasestorage.app",
            messagingSenderId: "1098617388770",
            appId: "1:1098617388770:web:8b6124a9ece62c9f81a8bb"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- SISTEMA DE ABAS ---
        function openTab(e, id) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(x => x.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            e.currentTarget.classList.add('active');
        }

        // --- GESTﾃグ DE RIFAS ---
        function addRifa() {
            const n = document.getElementById('rifaNome').value;
            const i = document.getElementById('rifaImg').value;
            const p = document.getElementById('rifaPreco').value;
            const t = document.getElementById('rifaTotal').value;

            if(!n || !i || !p || !t) return alert("Preencha todos os campos!");

            const newRifaRef = db.ref('rifas').push();
            newRifaRef.set({
                nome: n,
                img: i,
                preco: p,
                total: t,
                vendidas: 0,
                numerosVendidos: []
            }).then(() => {
                alert("Rifa criada com sucesso!");
                document.getElementById('rifaNome').value = '';
            });
        }

        function carregarRifasAdmin() {
            db.ref('rifas').on('value', (snapshot) => {
                const rifas = snapshot.val() || {};
                const container = document.getElementById('listaRifasAdm');
                container.innerHTML = Object.keys(rifas).map(id => {
                    const r = rifas[id];
                    return `
                    <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <img src="${r.img}" style="width:50px;">
                            <b>${r.nome}</b>
                        </div>
                        <button class="btn-action btn-red" onclick="removerRifa('${id}')">EXCLUIR</button>
                    </div>`;
                }).join('');
            });
        }
        function removerRifa(id) { if(confirm("Deseja excluir?")) db.ref('rifas/'+id).remove(); }

        // --- GESTﾃグ DE PAGAMENTOS ---
        function carregarPagamentosAdmin() {
            db.ref('pagamentos').on('value', (snapshot) => {
                const pagamentos = snapshot.val() || {};
                const body = document.getElementById('listaPagamentosBody');
                body.innerHTML = Object.keys(pagamentos).map(id => {
                    const p = pagamentos[id];
                    if(p.status !== 'pendente') return '';
                    return `
                    <tr>
                        <td>${p.usuario}</td>
                        <td>${p.rifa}</td>
                        <td>R$ ${p.valor}</td>
                        <td><a href="${p.comprovante}" download="comprovante.png" style="color:var(--primary); font-size:0.7rem;">BAIXAR</a></td>
                        <td>
                            <button class="btn-action btn-green" onclick="aprovarPagamento('${id}', '${p.rifaId}', ${p.cotas})">APROVAR</button>
                            <button class="btn-action btn-red" onclick="recusarPagamento('${id}')">RECUSAR</button>
                        </td>
                    </tr>`;
                }).join('') || '<tr><td colspan="5" style="text-align:center; padding:20px;">Nenhum pagamento pendente.</td></tr>';
            });
        }

        function aprovarPagamento(pagId, rifaId, qtdCotas) {
            // 1. Atualizar Rifa (Nﾃｺmeros Vendidos)
            db.ref('rifas/' + rifaId).once('value', (snap) => {
                const r = snap.val();
                let numeros = r.numerosVendidos || [];
                const novosNumeros = [];
                
                // Gerar nﾃｺmeros ﾃｺnicos (ex: comeﾃｧando do 001)
                while(novosNumeros.length < qtdCotas) {
                    let num = Math.floor(Math.random() * r.total) + 1;
                    let fmt = String(num).padStart(3, '0');
                    if(!numeros.includes(fmt) && !novosNumeros.includes(fmt)) novosNumeros.push(fmt);
                }

                db.ref('rifas/' + rifaId).update({
                    vendidas: r.vendidas + qtdCotas,
                    numerosVendidos: [...numeros, ...novosNumeros]
                });

                // 2. Atualizar status do pagamento e salvar nﾃｺmeros ganhos
                db.ref('pagamentos/' + pagId).update({
                    status: 'aprovado',
                    numeros: novosNumeros
                });
                
                alert("Pagamento Aprovado!");
            });
        }

        function recusarPagamento(id) { db.ref('pagamentos/'+id).update({status: 'recusado'}); }

        window.onload = () => {
            carregarRifasAdmin();
            carregarPagamentosAdmin();
        };
    </script>
</body>
</html>
