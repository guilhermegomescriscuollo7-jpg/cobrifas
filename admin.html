<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo | COBRIFAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #ffcc00;
            --primary-glow: rgba(255, 204, 0, 0.5);
            --bg-dark: #050505;
            --glass-bg: rgba(20, 20, 20, 0.95);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --white: #ffffff;
            --red: #ff4444;
            --green: #00ff66;
            --blue: #00a2ff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 15% 50%, rgba(255, 204, 0, 0.08) 0%, transparent 25%),
                url('https://images8.alphacoders.com/132/1328325.png');
            background-attachment: fixed; background-size: cover;
            color: var(--white); font-family: 'Rajdhani', sans-serif;
            height: 100vh; overflow: hidden;
        }

        .admin-wrapper { display: grid; grid-template-columns: 260px 1fr; height: 100vh; }

        /* --- SIDEBAR --- */
        aside {
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(20px);
            border-right: var(--glass-border); padding: 30px 20px;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .logo-adm { font-family: 'Orbitron'; font-size: 1.8rem; text-align: center; color: var(--primary); margin-bottom: 50px; text-shadow: 0 0 15px var(--primary-glow); }
        .nav-menu { display: flex; flex-direction: column; gap: 12px; }
        .nav-link {
            padding: 16px 20px; border-radius: 8px; cursor: pointer; transition: 0.3s;
            font-family: 'Orbitron'; font-size: 0.75rem; text-transform: uppercase; color: #888;
            display: flex; align-items: center; gap: 15px; border: 1px solid transparent;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255, 204, 0, 0.1); color: var(--primary); border-color: rgba(255, 204, 0, 0.3); }

        /* --- MAIN CONTENT --- */
        main { padding: 40px; overflow-y: auto; }
        .header-title { font-family: 'Orbitron'; font-size: 1.8rem; margin-bottom: 40px; display: flex; align-items: center; gap: 20px; text-transform: uppercase; }
        .header-title::before { content: ''; width: 8px; height: 30px; background: var(--primary); border-radius: 4px; box-shadow: 0 0 15px var(--primary); }

        .tab-content { display: none; animation: fadeInUp 0.5s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .glass-panel { background: var(--glass-bg); backdrop-filter: blur(25px); border: var(--glass-border); border-radius: 12px; padding: 30px; margin-bottom: 30px; }

        /* --- TABELAS --- */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { text-align: left; padding: 15px 20px; font-family: 'Orbitron'; font-size: 0.7rem; color: #888; text-transform: uppercase; }
        td { background: rgba(255,255,255,0.03); padding: 15px 20px; border-top: var(--glass-border); border-bottom: var(--glass-border); vertical-align: middle; }
        tr td:first-child { border-radius: 10px 0 0 10px; border-left: 3px solid var(--primary); }
        tr td:last-child { border-radius: 0 10px 10px 0; }

        .user-cell { display: flex; align-items: center; gap: 12px; }
        .user-img { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }

        /* --- BOTOES E INPUTS --- */
        .btn-action { padding: 8px 12px; border: none; border-radius: 4px; font-family: 'Orbitron'; font-size: 0.6rem; cursor: pointer; transition: 0.3s; margin-right: 5px; font-weight: bold; }
        .btn-green { background: var(--green); color: #000; }
        .btn-red { background: rgba(255, 68, 68, 0.1); color: var(--red); border: 1px solid var(--red); }
        .btn-red:hover { background: var(--red); color: #fff; }
        .btn-gold { background: var(--primary); color: #000; box-shadow: 0 0 15px rgba(255,204,0,0.4); font-weight: 900; }
        input, select { width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #333; color: #fff; border-radius: 6px; font-family: 'Rajdhani'; margin-bottom: 15px; }
        .btn-save { width:100%; padding:15px; background:var(--primary); border:none; font-weight:900; cursor:pointer; font-family: 'Orbitron'; color: #000; border-radius: 6px; }

        /* --- DASHBOARD STATS --- */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--glass-bg); padding: 30px; border-radius: 12px; border: var(--glass-border); text-align: center; }
        .stat-val { font-family: 'Orbitron'; font-size: 2rem; color: var(--primary); font-weight: 900; }

        /* --- CHAT LAYOUT --- */
        .chat-layout { display: grid; grid-template-columns: 300px 1fr; height: 600px; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; overflow: hidden; }
        .chat-sidebar { background: rgba(0, 0, 0, 0.8); border-right: 1px solid rgba(255, 255, 255, 0.1); overflow-y: auto; }
        .contact-item { padding: 15px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); cursor: pointer; }
        .contact-item.active { background: rgba(255, 204, 0, 0.1); border-left: 3px solid var(--primary); }
        .winner-tag { background: var(--primary); color: #000; font-size: 0.55rem; font-weight: 900; padding: 2px 6px; border-radius: 3px; display: inline-block; margin-top: 4px; font-family: Orbitron; }
        .msg-bubble { max-width: 70%; padding: 10px 15px; border-radius: 10px; font-size: 0.9rem; margin-bottom: 10px; position: relative; }
        .msg-user { align-self: flex-start; background: #333; }
        .msg-admin { align-self: flex-end; background: var(--primary); color: #000; font-weight: bold; }

        /* --- MODAL SORTEIO --- */
        #modalSorteio { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:5000; align-items:center; justify-content:center; backdrop-filter: blur(15px); }
        .sorteio-card { text-align: center; width: 100%; max-width: 550px; padding: 40px; border: 2px solid var(--primary); border-radius: 20px; background: #000; }
        .sorteio-numero { font-size: 7rem; font-family: 'Orbitron'; color: var(--primary); text-shadow: 0 0 40px var(--primary); margin: 20px 0; font-weight: 900; }
    </style>
</head>
<body>

    <div class="admin-wrapper">
        <aside>
            <div>
                <div class="logo-adm">COB<span>ADM</span></div>
                <nav class="nav-menu">
                    <div class="nav-link active" onclick="openTab(event, 'dash')">üìä DASHBOARD</div>
                    <div class="nav-link" onclick="openTab(event, 'membros')">üë• MEMBROS</div>
                    <div class="nav-link" onclick="openTab(event, 'pagamentos')">üí∏ PAGAMENTOS</div>
                    <div class="nav-link" onclick="openTab(event, 'rifas')">‚ö° RIFAS</div>
                    <div class="nav-link" onclick="openTab(event, 'pix')">üîë CHAVE PIX</div>
                    <div class="nav-link" onclick="openTab(event, 'chat')">üí¨ CHAT</div>
                    <div class="nav-link" onclick="window.open('sorteador.html', '_blank')" style="color:var(--primary);">üé≤ SORTEADOR</div>
                </nav>
            </div>
            <div class="nav-link" onclick="location.href='index.html'" style="color:var(--red);">üö™ SAIR</div>
        </aside>

        <main>
            <section id="dash" class="tab-content active">
                <div class="header-title">VIS√ÉO GERAL</div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-val" id="countMembros">0</div><div style="font-size:0.7rem; font-family:Orbitron;">MEMBROS</div></div>
                    <div class="stat-card"><div class="stat-val" id="countRifas">0</div><div style="font-size:0.7rem; font-family:Orbitron;">RIFAS</div></div>
                    <div class="stat-card"><div class="stat-val" id="totalVendas">R$ 0,00</div><div style="font-size:0.7rem; font-family:Orbitron;">VENDAS</div></div>
                </div>
            </section>

            <section id="membros" class="tab-content">
                <div class="header-title">GERENCIAR MEMBROS</div>
                <div class="glass-panel">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <input type="text" id="buscaNome" placeholder="üîç Filtrar por Nome..." onkeyup="filtrarTabelaMembros()">
                        <input type="text" id="buscaCPF" placeholder="üîç Filtrar por CPF..." onkeyup="filtrarTabelaMembros()">
                    </div>
                    <table>
                        <thead><tr><th>MEMBRO</th><th>CPF</th><th>TEL</th><th>A√á√ïES</th></tr></thead>
                        <tbody id="listaMembrosBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="pagamentos" class="tab-content">
                <div class="header-title">APROVAR PAGAMENTOS</div>
                <div class="glass-panel">
                    <table>
                        <thead>
                            <tr>
                                <th>USER</th>
                                <th>CPF</th> <th>RIFA</th>
                                <th>VALOR</th>
                                <th>COMPROVANTE</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="listaPagamentos"></tbody>
                    </table>
                </div>
            </section>

            <section id="rifas" class="tab-content">
                <div class="header-title">GERENCIAR RIFAS</div>
                <div class="glass-panel">
                    <h3 style="font-family:Orbitron; margin-bottom:20px; color:#888;">NOVA RIFA</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <input type="text" id="rifaNome" placeholder="Nome da Skin">
                        <input type="text" id="rifaImg" placeholder="URL da Imagem">
                        <input type="number" id="rifaPreco" placeholder="Pre√ßo Unit√°rio (R$)">
                        <input type="number" id="rifaTotal" placeholder="Total de Cotas">
                    </div>
                    
                    <h3 style="font-family:Orbitron; margin:20px 0; color:var(--primary); font-size:0.8rem;">üèÜ PR√äMIO TOP COMPRADOR (OPCIONAL)</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <input type="text" id="bNome" placeholder="Nome do Pr√™mio B√¥nus">
                        <input type="text" id="bImg" placeholder="URL Imagem B√¥nus">
                    </div>

                    <button class="btn-save" onclick="addRifa()">CRIAR RIFA NO FIREBASE</button>
                </div>
                <div id="listaRifasAdm"></div>
            </section>

            <section id="pix" class="tab-content">
                <div class="header-title">CONFIGURAR CHAVE PIX</div>
                <div class="glass-panel" style="max-width: 500px;">
                    <select id="pixTipo"><option value="CPF">CPF</option><option value="EMAIL">E-mail</option><option value="ALEATORIA">Chave Aleat√≥ria</option></select>
                    <input type="text" id="pixChave" placeholder="Sua chave...">
                    <button class="btn-save" onclick="salvarPix()">SALVAR PIX</button>
                </div>
            </section>

            <section id="chat" class="tab-content">
                <div class="header-title">SUPORTE AO CLIENTE</div>
                <div class="chat-layout">
                    <div class="chat-sidebar" id="listaContatos"></div>
                    <div class="chat-main" style="display:flex; flex-direction:column;">
                        <div id="chatHeader" style="padding:15px; border-bottom:1px solid #333; font-family:Orbitron; background: rgba(0,0,0,0.5);">SELECIONE UM OPERADOR</div>
                        <div id="chatMessagesBox" style="flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column;"></div>
                        <div style="padding:15px; background:#000; display:flex; gap:10px;">
                            <input type="text" id="respAdm" placeholder="Resposta..." disabled>
                            <button class="btn-action btn-green" onclick="responderChat()" id="btnEnviarChat" disabled>ENVIAR</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="modalSorteio">
        <div class="sorteio-card">
            <h2 id="sorteioItemName" style="font-family:Orbitron;">NOME DO ITEM</h2>
            <div id="sorteioNumero" class="sorteio-numero">---</div>
            <div id="winnerContainer" style="display:none; margin-top:20px;">
                <div id="winName" style="font-size:1.5rem; font-family:Orbitron; color:#fff;">VENCEDOR: ...</div>
                <button class="btn-save" style="width:200px; margin-top:20px;" onclick="document.getElementById('modalSorteio').style.display='none'">ENCERRAR</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBfX7oMSNn4gSL1Knfx-yvwBwkX4H7JjQg",
            authDomain: "cobrifas.firebaseapp.com",
            projectId: "cobrifas",
            storageBucket: "cobrifas.firebasestorage.app",
            messagingSenderId: "1098617388770",
            appId: "1:1098617388770:web:8b6124a9ece62c9f81a8bb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let chatAtivoCPF = null;
        let listaMembrosCache = {}; // Vari√°vel para guardar os membros e filtrar r√°pido

        function openTab(e, id) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(x => x.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(e) e.currentTarget.classList.add('active');
            if(id === 'chat') renderChat();
        }

        /* --- DASHBOARD --- */
        function updateDash() {
            db.ref('/').on('value', s => {
                const data = s.val() || {};
                document.getElementById('countMembros').innerText = data.membros ? Object.keys(data.membros).length : 0;
                document.getElementById('countRifas').innerText = data.rifas ? Object.keys(data.rifas).length : 0;
                let total = 0;
                if(data.pagamentos) Object.values(data.pagamentos).forEach(p => { if(p.status === 'aprovado') total += parseFloat(p.valor); });
                document.getElementById('totalVendas').innerText = `R$ ${total.toFixed(2)}`;
            });
        }

        /* --- RIFAS COM B√îNUS --- */
        function addRifa() {
            const n=document.getElementById('rifaNome').value, i=document.getElementById('rifaImg').value, p=document.getElementById('rifaPreco').value, t=document.getElementById('rifaTotal').value;
            const bn=document.getElementById('bNome').value, bi=document.getElementById('bImg').value;
            if(!n||!i||!p||!t) return alert("Campos obrigat√≥rios vazios!");
            db.ref('rifas').push({ nome:n, img:i, preco:p, total:t, vendidas:0, bonus: bn ? {nome:bn, img:bi} : null, numerosVendidos:[] })
            .then(() => alert("Rifa criada!"));
        }

        function renderRifas() {
            db.ref('rifas').on('value', s => {
                const rifas = s.val() || {};
                document.getElementById('listaRifasAdm').innerHTML = Object.keys(rifas).map(id => {
                    const r = rifas[id];
                    const v = r.numerosVendidos ? r.numerosVendidos.length : 0;
                    // CALCULO DAS COTAS RESTANTES
                    const restantes = parseInt(r.total) - v;
                    
                    let btn = r.ganhador ? 'üèÜ FINALIZADA' : (v >= r.total ? `<button class="btn-action btn-gold" onclick="abrirSorteio('${id}')">SORTEAR</button>` : 'EM ANDAMENTO');
                    
                    return `<div class="glass-panel" style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <img src="${r.img}" style="width:50px;">
                            <div>
                                <b>${r.nome}</b>
                                <div style="font-size:0.75rem; color:#aaa;">Restam: <span style="color:var(--primary); font-weight:bold;">${restantes}</span> / ${r.total}</div>
                            </div>
                        </div>
                        <div>${btn} <button class="btn-action btn-red" onclick="if(confirm('Excluir?')) db.ref('rifas/${id}').remove()">X</button></div></div>`;
                }).join('');
            });
        }

        /* --- PAGAMENTOS ATUALIZADOS --- */
        function renderPagamentos() {
            db.ref('pagamentos').on('value', s => {
                const pags = s.val() || {};
                document.getElementById('listaPagamentos').innerHTML = Object.keys(pags).filter(id => pags[id].status === 'pendente').map(id => {
                    const p = pags[id];
                    return `<tr>
                        <td><b>${p.usuario}</b></td>
                        <td>${p.cpf}</td> <td>${p.rifa}</td>
                        <td>R$ ${p.valor}</td>
                        <td><a href="${p.comprovante}" download target="_blank" style="color:var(--primary)">BAIXAR</a></td>
                        <td>
                            <button class="btn-action btn-green" onclick="aprovarPagamento('${id}','${p.rifaId}',${p.cotas})">OK</button>
                            <button class="btn-action btn-red" onclick="reprovarPagamento('${id}')">X</button> </td>
                    </tr>`;
                }).join('') || '<tr><td colspan="6" align="center">Vazio.</td></tr>';
            });
        }

        function aprovarPagamento(pagId, rifaId, qtd) {
            db.ref(`rifas/${rifaId}`).once('value', s => {
                const r = s.val();
                let existentes = r.numerosVendidos || [];
                const novos = [];
                while(novos.length < qtd) {
                    let n = Math.floor(Math.random()*r.total)+1;
                    let f = String(n).padStart(3,'0');
                    if(!existentes.includes(f) && !novos.includes(f)) novos.push(f);
                }
                db.ref(`rifas/${rifaId}`).update({ vendidas: (r.vendidas||0)+qtd, numerosVendidos: [...existentes, ...novos] });
                db.ref(`pagamentos/${pagId}`).update({ status: 'aprovado', numeros: novos });
                alert("Aprovado!");
            });
        }

        function reprovarPagamento(id) {
            if(confirm("Deseja recusar este pagamento?")) {
                db.ref(`pagamentos/${id}`).update({ status: 'recusado' });
            }
        }

        /* --- SORTEIO REALTIME --- */
        function abrirSorteio(id) {
            db.ref(`rifas/${id}`).once('value', s => {
                const r = s.val();
                document.getElementById('modalSorteio').style.display = 'flex';
                document.getElementById('sorteioItemName').innerText = r.nome;
                let c = 0;
                const intv = setInterval(() => {
                    document.getElementById('sorteioNumero').innerText = Math.floor(Math.random()*r.total)+1;
                    if(++c > 20) { clearInterval(intv); realizarSorteio(id); }
                }, 100);
            });
        }

        function realizarSorteio(id) {
            db.ref(`rifas/${id}`).once('value', sr => {
                const r = sr.val();
                const numVenc = r.numerosVendidos[Math.floor(Math.random()*r.numerosVendidos.length)];
                db.ref('pagamentos').once('value', sp => {
                    const pgVenc = Object.values(sp.val()).find(p => p.numeros && p.numeros.includes(numVenc));
                    document.getElementById('sorteioNumero').innerText = numVenc;
                    document.getElementById('winName').innerText = "VENCEDOR: " + (pgVenc ? pgVenc.usuario : "N/A");
                    document.getElementById('winnerContainer').style.display = 'block';
                    db.ref(`rifas/${id}`).update({ ganhador: { nome: pgVenc.usuario, numero: numVenc, cpf: pgVenc.cpf, visto: false, dataSorteio: new Date().toLocaleString() } });
                });
            });
        }

        /* --- CHAT INTELIGENTE --- */
        function renderChat() {
            db.ref('membros').once('value', sMemb => {
                const membros = sMemb.val() || {};
                db.ref('rifas').once('value', sRifas => {
                    const rifas = sRifas.val() || {};
                    db.ref('chatLog').on('value', sLogs => {
                        const logs = sLogs.val() || {};
                        const cpfs = [...new Set(Object.values(logs).map(l => l.userCpf))];
                        document.getElementById('listaContatos').innerHTML = cpfs.map(cpf => {
                            const mKey = Object.keys(membros).find(k => membros[k].cpf === cpf);
                            const m = mKey ? membros[mKey] : { nome: "Usu√°rio Externo" };
                            const ganhou = Object.values(rifas).some(r => r.ganhador && r.ganhador.cpf === cpf);
                            return `<div class="contact-item ${chatAtivoCPF === cpf ? 'active' : ''}" onclick="abrirChat('${cpf}', '${m.nome}')">
                                <div class="contact-info"><b>${m.nome}</b><span>CPF: ${cpf}</span>${ganhou ? '<div class="winner-tag">üèÜ GANHADOR</div>' : ''}</div></div>`;
                        }).join('');
                        if(chatAtivoCPF) loadMessages();
                    });
                });
            });
        }

        function abrirChat(cpf, nome) {
            chatAtivoCPF = cpf;
            document.getElementById('chatHeader').innerText = nome + " (" + cpf + ")";
            document.getElementById('respAdm').disabled = false;
            document.getElementById('btnEnviarChat').disabled = false;
            loadMessages();
        }

        function loadMessages() {
            db.ref('chatLog').on('value', s => {
                const msgs = Object.values(s.val() || {}).filter(m => m.userCpf === chatAtivoCPF);
                document.getElementById('chatMessagesBox').innerHTML = msgs.map(m => `
                    <div class="msg-bubble ${m.from==='admin'?'msg-admin':'msg-user'}">${m.text}</div>`).join('');
                document.getElementById('chatMessagesBox').scrollTop = 99999;
            });
        }

        function responderChat() {
            const t = document.getElementById('respAdm').value; if(!t) return;
            db.ref('chatLog').push({ userCpf: chatAtivoCPF, from:'admin', text:t, time: new Date().toLocaleTimeString().slice(0,5) });
            document.getElementById('respAdm').value = '';
        }

        /* --- PIX E MEMBROS --- */
        function carregarPix() {
            db.ref('config/pix').on('value', s => {
                const data = s.val();
                if(data) {
                    if(data.tipo) document.getElementById('pixTipo').value = data.tipo;
                    if(data.chave) document.getElementById('pixChave').value = data.chave;
                }
            });
        }

        function salvarPix() { 
            db.ref('config/pix').set({ 
                tipo: document.getElementById('pixTipo').value, 
                chave: document.getElementById('pixChave').value 
            }).then(() => alert("Salvo!")); 
        }

        // --- FUN√á√ïES DE MEMBROS E FILTROS (NOVA L√ìGICA) ---
        function renderMembros() {
            // Apenas carrega os dados e salva na variavel cache
            db.ref('membros').on('value', s => {
                listaMembrosCache = s.val() || {};
                filtrarTabelaMembros(); // Chama o filtro que gera a tabela
            });
        }

        function filtrarTabelaMembros() {
            // Pega os valores digitados
            const nomeFiltro = document.getElementById('buscaNome').value.toLowerCase();
            const cpfFiltro = document.getElementById('buscaCPF').value;

            // Gera o HTML filtrando os dados
            const html = Object.keys(listaMembrosCache).map(id => {
                const m = listaMembrosCache[id];
                
                // L√≥gica de Filtro
                const matchNome = (m.nome || "").toLowerCase().includes(nomeFiltro);
                const matchCPF = (m.cpf || "").includes(cpfFiltro);

                if (matchNome && matchCPF) {
                    return `<tr>
                        <td><div class="user-cell"><img src="${m.avatar}" class="user-img"><b>${m.nome}</b></div></td>
                        <td>${m.cpf}</td>
                        <td>${m.tel}</td>
                        <td>
                            <button class="btn-action btn-orange" onclick="db.ref('membros/${id}').update({status:'BANIDO'})">BANIR</button>
                            <button class="btn-action btn-red" onclick="if(confirm('Apagar?')) db.ref('membros/${id}').remove()">X</button>
                        </td>
                    </tr>`;
                } else {
                    return ""; // N√£o exibe se n√£o bater com o filtro
                }
            }).join('');

            document.getElementById('listaMembrosBody').innerHTML = html;
        }

        window.onload = () => { 
            updateDash(); renderMembros(); renderRifas(); renderPagamentos(); carregarPix(); 
            
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('openChat')) {
                openTab(null, 'chat');
                alert("O ganhador tem o CPF: " + urlParams.get('openChat') + ". Localize-o na lista de contatos.");
            }
        };
    </script>
</body>
</html>
